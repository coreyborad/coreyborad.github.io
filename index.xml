<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>Corey Post</title><link>https://coreyborad.github.io/</link><description>Corey Post</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Tue, 15 Mar 2022 12:00:00 +0800</lastBuildDate><atom:link href="https://coreyborad.github.io/index.xml" rel="self" type="application/rss+xml"/><item><title>AWS API Gateway 之 Resource Policy探討</title><link>https://coreyborad.github.io/posts/documentation/aws-vpc-api-gateway/aws-vpc-apigateway/</link><pubDate>Tue, 15 Mar 2022 12:00:00 +0800</pubDate><guid>https://coreyborad.github.io/posts/documentation/aws-vpc-api-gateway/aws-vpc-apigateway/</guid><description><![CDATA[前言 AWS API Gateway是AWS Serverless的服務之一，用於建立REST API服務用，而有些狀況下，REST API我們想要只開放給特定服務，或是自己內部的AWS Service使用
本篇文章會簡單說明，如何透過Resource Policy來控制AWS API Gateway的Access
API Gateway Type API Gateway根據開放特性，還有延遲性等有不同的Type可以選擇
Regional and Edge Optimized 這2種類型都是屬於Public Type，Internet都可以Access到，2者細部的差異在於Edge Optimized可以自行產生Cookie，來跟CDN做搭配，Regional則屬於放置在特地區域的API Gateway，當然還有更多細節差異，不過與本篇要探討的無關
Private 如字面意思，這種Type需要搭配Resource Policy來過濾你的Request來源，也是本篇的重點，基本上可以有3種方式來進行Filter，AWS IAM, AWS VPC, AWS VPC Endpoint
Resource Policy 除了可以針對整個API Gateway Resource去做限制之外，也可以細節到後續的Path限制，算是很大的細分 如果被Deny成功，後續也不會再近到AWS Lambda這層，可以節省費用
Deny的Response通常會長這樣 AWS Account { &#34;Version&#34;: &#34;2012-10-17&#34;, &#34;Statement&#34;: [ { &#34;Effect&#34;: &#34;Allow&#34;, &#34;Principal&#34;: { &#34;AWS&#34;: [ &#34;arn:aws:iam::{{otherAWSAccountID}}:root&#34;, &#34;arn:aws:iam::{{otherAWSAccountID}}:user/{{otherAWSUserName}}&#34;, &#34;arn:aws:iam::{{otherAWSAccountID}}:role/{{otherAWSRoleName}}&#34; ] }, &#34;Action&#34;: &#34;execute-api:Invoke&#34;, &#34;Resource&#34;: [ &#34;execute-api:/{{stageNameOrWildcard*}}/{{httpVerbOrWildcard*}}/{{resourcePathOrWildcard*}}&#34; ] } ] } IP Range { &#34;Version&#34;: &#34;2012-10-17&#34;, &#34;Statement&#34;: [ { &#34;Effect&#34;: &#34;Deny&#34;, &#34;Principal&#34;: &#34;*&#34;, &#34;Action&#34;: &#34;execute-api:Invoke&#34;, &#34;Resource&#34;: &#34;execute-api:/{{stageNameOrWildcard}}/{{httpVerbOrWildcard}}/{{resourcePathOrWildcard}}&#34;, &#34;Condition&#34; : { &#34;IpAddress&#34;: { &#34;aws:SourceIp&#34;: [ &#34;10.]]></description></item></channel></rss>